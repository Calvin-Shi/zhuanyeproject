{% comment %}
This pagination template is now upgraded to preserve existing GET parameters.
It requires one context variable:
- page_obj: The paginator page object.
{% endcomment %}
{% if page_obj.has_other_pages %}
<div class="pagination">
    <div class="pagination-links">
        {# MODIFIED: Removed invalid hyphens from template tags #}
        {% with base_query=request.GET.urlencode|cut:"&page="|cut:"page=" %}
            {% if page_obj.has_previous %}
                <a href="?page=1{% if base_query %}&{{ base_query }}{% endif %}">&laquo; 首页</a>
                <a href="?page={{ page_obj.previous_page_number }}{% if base_query %}&{{ base_query }}{% endif %}">上一页</a>
            {% endif %}

            {% for i in page_obj.paginator.page_range %}
                {% if page_obj.number == i %}
                    <span class="current">{{ i }}</span>
                {% elif i > page_obj.number|add:'-3' and i < page_obj.number|add:'3' %}
                    <a href="?page={{ i }}{% if base_query %}&{{ base_query }}{% endif %}">{{ i }}</a>
                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if base_query %}&{{ base_query }}{% endif %}">下一页</a>
                <a href="?page={{ page_obj.paginator.num_pages }}{% if base_query %}&{{ base_query }}{% endif %}">尾页 &raquo;</a>
            {% endif %}
        {% endwith %}
    </div>
    <span class="page-info">第 {{ page_obj.number }} / {{ page_obj.paginator.num_pages }} 页</span>
</div>
{% endif %}