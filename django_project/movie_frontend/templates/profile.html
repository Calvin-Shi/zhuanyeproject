{% extends 'base.html' %}

{% block title %}个人资料 - 电影推荐系统{% endblock %}

{% block content %}
<section class="profile-page">
    <h1>个人资料</h1>

    <div class="user-info">
        <!-- 显示用户信息 -->
        <h2>{{ user.profile.nickname|default:user.username }}</h2>  <!-- 优先显示昵称，无则显示用户名 -->
        <p><strong>用户名：</strong>{{ user.username }}</p>
        {% if user.email %}
            <p><strong>邮箱：</strong>{{ user.email }}</p>
        {% endif %}
        {% if user.profile.signature %}
            <p><strong>个人签名：</strong>{{ user.profile.signature }}</p>
        {% endif %}

        <!-- 编辑昵称和签名的表单 -->
        <div class="profile-edit-form">
            <h3>编辑个人信息</h3>
            <form method="post">
                {% csrf_token %}

                <div class="form-group">
                    <label for="{{ form.nickname.id_for_label }}">昵称：</label>
                    {{ form.nickname }}  <!-- 表单字段：昵称输入框 -->
                </div>

                <div class="form-group">
                    <label for="{{ form.signature.id_for_label }}">个人签名：</label>
                    {{ form.signature }}  <!-- 表单字段：签名文本框 -->
                </div>

                <button type="submit" class="btn-primary">保存修改</button>
            </form>
        </div>
    </div>

    <!-- "喜欢的电影"显示区域） -->
    <div class="favorite-movies">
        <h3>你喜欢的电影</h3>
        {% if favorite_movies %}
            <div class="movie-grid">
                {% for movie in favorite_movies %}
                    <div class="movie-card">
                        <div class="movie-title">{{ movie.display_title }}</div>
                        <div class="genres">
                            {% for genre in movie.genres.all|slice:':2' %}
                                <span class="genre-tag">{{ genre.name }}</span>
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p>你还没有选择喜欢的电影，<a href="{% url 'movie_frontend:choose_favorites' %}">去选择</a></p>
        {% endif %}
    </div>
</section>
{% endblock %}

{% block extra_css %}
<!-- 添加表单样式 -->
<style>
.form-group {
    margin: 15px 0;
}
.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}
.form-group input, .form-group textarea {
    width: 100%;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
    box-sizing: border-box;
}
.profile-edit-form {
    margin: 20px 0;
    padding: 20px;
    border: 1px solid #f0f0f0;
    border-radius: 6px;
}
.btn-primary {
    background: #007bff;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
}
.btn-primary:hover {
    background: #0056b3;
}
</style>
{% endblock %}